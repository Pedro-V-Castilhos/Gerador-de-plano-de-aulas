import { GoogleGenAI } from "@google/genai";
import { useState } from "react";
import { markdownToPdf } from "../../handlers/pdfHandler";

const ai = new GoogleGenAI({apiKey: import.meta.env.VITE_GEMINI_API_KEY});

export const useGeneratePlan = () => {
    const [aiResponse, setResponse] = useState<string | null>(null)
    const [error, setError] = useState<unknown | null>(null)

    const generatePlan = async(theme: string, schoolLevel:string, content:string) => {
        setError(null);
        setResponse(null);

        try{
            const response = await ai.models.generateContent({
                model: "gemini-2.0-flash",
                contents: `Gere um plano de aulas sobre ${theme}. O plano de aulas deverá estar adaptado para uma turma que está na etapa escolar: ${schoolLevel} e deve conter os seguintes temas: ${content}. O plano deve ser gerado em formato markdown` + 
                "Siga o exemplo:" + 
                "Input: " + 
                "* Tema: Química orgânica" + 
                "* Nível escolar: Ensino Médio" + 
                "* Conteúdos que deve conter: Compostos orgânicos" + 
                "Output:" + 
                "## Plano de Aulas de Química Orgânica - Compostos Orgânicos (Nível Superior)\n\n*Público Alvo:* Alunos de graduação (Química, Engenharia Química, Biologia, etc.)\n*Carga Horária:* 40 horas (Flexível, dependendo do ritmo da turma)\n*Objetivo Geral:* Apresentar e consolidar os conceitos fundamentais da Química Orgânica, com foco na estrutura, nomenclatura, propriedades e reações dos principais grupos funcionais orgânicos.\n\n*Estrutura do Plano:*\n\nEste plano de aulas está dividido em módulos, cada um com objetivos específicos, conteúdo programático, atividades e avaliações.\n\n*Módulo 1: Introdução à Química Orgânica e Ligações Químicas (8 horas)*\n\n*   *Objetivos:*\n    *   Compreender a importância e o escopo da Química Orgânica.\n    *   Revisar conceitos fundamentais de ligações químicas (covalente, iônica, metálica).\n    *   Entender a formação de ligações sigma (σ) e pi (π).\n    *   Dominar a representação de estruturas orgânicas (fórmulas estruturais, condensadas, de linha/esqueleto).\n    *   Compreender o conceito de isomeria (estrutural e espacial).\n*   *Conteúdo Programático:*\n    *   Definição e história da Química Orgânica.\n    *   O átomo de carbono: hibridização (sp3, sp2, sp) e geometria molecular.\n    *   Ligações covalentes: polaridade, eletronegatividade e momento dipolar.\n    *   Representação de estruturas orgânicas: fórmulas estruturais completas, condensadas e de linha/esqueleto.\n    *   Isomeria: estrutural (cadeia, posição, função) e espacial (geométrica cis/trans).\n    *   Ressonância e estabilidade de moléculas.\n*   *Atividades:*\n    *   Discussão em sala de aula sobre a importância da Química Orgânica em diferentes áreas.\n    *   Exercícios de representação de estruturas orgânicas.\n    *   Identificação e classificação de diferentes tipos de isomeria.\n    *   Construção de modelos moleculares.\n*   *Avaliação:*\n    *   Questionário sobre conceitos básicos e representação de estruturas.\n    *   Resolução de exercícios de isomeria.\n\n*Módulo 2: Alcanos, Alcenos e Alcinos (8 horas)*\n\n*   *Objetivos:*\n    *   Compreender a estrutura, nomenclatura (IUPAC) e propriedades físicas dos alcanos, alcenos e alcinos.\n    *   Reconhecer e aplicar os diferentes tipos de reações de alcanos (halogenação), alcenos (adição) e alcinos (hidratação).\n    *   Entender a regra de Markovnikov e sua aplicação.\n    *   Compreender o conceito de estabilidade relativa de alcenos.\n*   *Conteúdo Programático:*\n    *   Alcanos: estrutura, nomenclatura (IUPAC), propriedades físicas, reações de halogenação (mecanismo de radicais livres).\n    *   Alcenos: estrutura, nomenclatura (IUPAC), propriedades físicas, reações de adição (hidrogenação, halogenação, adição de HX - regra de Markovnikov, hidratação).\n    *   Alcinos: estrutura, nomenclatura (IUPAC), propriedades físicas, reações de adição (hidrogenação, halogenação, adição de HX - regra de Markovnikov, hidratação).\n    *   Estabilidade relativa de alcenos: hiperconjugação.\n*   *Atividades:*\n    *   Resolução de exercícios de nomenclatura IUPAC.\n    *   Escrita de mecanismos de reação.\n    *   Previsão de produtos de reação com base na regra de Markovnikov.\n    *   Discussão sobre aplicações industriais de alcanos, alcenos e alcinos.\n*   *Avaliação:*\n    *   Prova escrita com questões de nomenclatura, reações e mecanismos.\n    *   Resolução de problemas envolvendo a aplicação da regra de Markovnikov.\n\n*Módulo 3: Compostos Cíclicos e Aromáticos (8 horas)*\n\n*   *Objetivos:*\n    *   Compreender a estrutura, nomenclatura e propriedades físicas dos cicloalcanos e cicloalcenos.\n    *   Entender o conceito de tensão anelar e sua influência na estabilidade dos cicloalcanos.\n    *   Compreender a estrutura e propriedades do benzeno e seus derivados.\n    *   Entender o conceito de aromaticidade (Regra de Hückel).\n    *   Reconhecer e aplicar as reações de substituição eletrofílica aromática (SEA).\n*   *Conteúdo Programático:*\n    *   Cicloalcanos e cicloalcenos: estrutura, nomenclatura (IUPAC), propriedades físicas, conformações (cadeira, barco).\n    *   Tensão anelar: teoria de Baeyer, anéis de 5 e 6 membros.\n    *   Compostos aromáticos: estrutura do benzeno (ressonância, deslocalização de elétrons), nomenclatura de derivados do benzeno.\n    *   Aromaticidade: Regra de Hückel (4n+2 elétrons π).\n    *   Reações de Substituição Eletrofílica Aromática (SEA): halogenação, nitração, sulfonação, alquilação e acilação de Friedel-Crafts (mecanismos e aplicações).\n    *   Efeitos de grupos substituintes na reatividade e orientação em reações de SEA.\n*   *Atividades:*\n    *   Construção de modelos moleculares de cicloalcanos e cicloalcenos.\n    *   Resolução de exercícios de nomenclatura de compostos cíclicos e aromáticos.\n    *   Escrita de mecanismos de reações de SEA.\n    *   Previsão de produtos majoritários em reações de SEA considerando o efeito de grupos substituintes.\n*   *Avaliação:*\n    *   Prova escrita com questões de nomenclatura, estrutura, aromaticidade e reações de SEA.\n    *   Resolução de problemas envolvendo a aplicação da Regra de Hückel.\n\n*Módulo 4: Grupos Funcionais I: Álcoois, Éteres, Aldeídos e Cetonas (8 horas)*\n\n*   *Objetivos:*\n    *   Compreender a estrutura, nomenclatura e propriedades físicas de álcoois, éteres, aldeídos e cetonas.\n    *   Reconhecer e aplicar as principais reações de álcoois (desidratação, oxidação), éteres (clivagem) e aldeídos/cetonas (adição nucleofílica).\n    *   Entender a reatividade relativa de aldeídos e cetonas.\n*   *Conteúdo Programático:*\n    *   Álcoois: estrutura, nomenclatura (IUPAC), propriedades físicas (ligação de hidrogênio), acidez.\n    *   Reações de álcoois: desidratação (formação de alcenos), oxidação (formação de aldeídos, cetonas, ácidos carboxílicos).\n    *   Éteres: estrutura, nomenclatura (IUPAC), propriedades físicas, clivagem por ácidos fortes.\n    *   Aldeídos e cetonas: estrutura, nomenclatura (IUPAC), propriedades físicas, reatividade (adição nucleofílica).\n    *   Reações de adição nucleofílica: formação de hidratos, hemiacetais e acetais, reação de Wittig.\n*   *Atividades:*\n    *   Resolução de exercícios de nomenclatura IUPAC.\n    *   Escrita de mecanismos de reações.\n    *   Previsão de produtos de reação.\n    *   Discussão sobre aplicações industriais de álcoois, éteres, aldeídos e cetonas.\n*   *Avaliação:*\n    *   Prova escrita com questões de nomenclatura, reações e mecanismos.\n    *   Resolução de problemas envolvendo a aplicação de reações de adição nucleofílica.\n\n*Módulo 5: Grupos Funcionais II: Ácidos Carboxílicos, Ésteres, Aminas e Amidas (8 horas)*\n\n*   *Objetivos:*\n    *   Compreender a estrutura, nomenclatura e propriedades físicas de ácidos carboxílicos, ésteres, aminas e amidas.\n    *   Reconhecer e aplicar as principais reações de ácidos carboxílicos (esterificação, redução), ésteres (hidrólise), aminas (reação com ácidos) e amidas (hidrólise).\n    *   Entender a basicidade relativa de aminas.\n*   *Conteúdo Programático:*\n    *   Ácidos carboxílicos: estrutura, nomenclatura (IUPAC), propriedades físicas (acidez), formação de sais.\n    *   Reações de ácidos carboxílicos: esterificação de Fischer, redução (formação de álcoois).\n    *   Ésteres: estrutura, nomenclatura (IUPAC), propriedades físicas, hidrólise (ácida e básica).\n    *   Aminas: estrutura, nomenclatura (IUPAC), propriedades físicas (basicidade), reação com ácidos (formação de sais de amônio).\n    *   Amidas: estrutura, nomenclatura (IUPAC), propriedades físicas, hidrólise (ácida e básica).\n*   *Atividades:*\n    *   Resolução de exercícios de nomenclatura IUPAC.\n    *   Escrita de mecanismos de reações.\n    *   Previsão de produtos de reação.\n    *   Discussão sobre aplicações industriais de ácidos carboxílicos, ésteres, aminas e amidas.\n*   *Avaliação:*\n    *   Prova escrita com questões de nomenclatura, reações e mecanismos.\n    *   Resolução de problemas envolvendo a aplicação de reações de hidrólise.\n\n*Avaliação Geral:*\n\n*   Provas escritas ao final de cada módulo (50% da nota final).\n*   Participação em sala de aula e resolução de exercícios (20% da nota final).\n*   Trabalho prático (síntese de um composto orgânico ou análise de um artigo científico) (30% da nota final).\n\n*Recursos:*\n\n*   Livro texto de Química Orgânica (ex: Paula Yurkanis Bruice, Vollhardt & Schore, Solomons & Fryhle).\n*   Artigos científicos relevantes.\n*   Softwares de modelagem molecular.\n*   Projetor multimídia e quadro branco.\n\n*Observações:*\n\n*   Este plano de aulas é flexível e pode ser adaptado às necessidades e interesses da turma.\n*   É importante incentivar a participação dos alunos em sala de aula e a resolução de exercícios.\n*   O trabalho prático pode ser ajustado de acordo com a disponibilidade de recursos e equipamentos.\n*   A utilização de modelos moleculares e softwares de modelagem pode auxiliar na compreensão dos conceitos.",
            })
            console.log(response.text)
            setResponse(await markdownToPdf(response.text ?? "Ops! Algo deu errado!") ?? null)
        }catch(e:unknown){
            if(e instanceof Error){
                console.log(e.message)
            }else{
                console.log(e)
            }
        }
    }

    return {aiResponse, error, generatePlan}
}